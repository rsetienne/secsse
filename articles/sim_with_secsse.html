<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="secsse">
<title>Simulating with secsse • secsse</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulating with secsse">
<meta property="og:description" content="secsse">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">secsse</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/starting_secsse.html">Starting secsse</a>
    <a class="dropdown-item" href="../articles/plotting_states.html">Plotting probabilities</a>
    <a class="dropdown-item" href="../articles/sim_with_secsse.html">Simulating with secsse</a>
    <a class="dropdown-item" href="../articles/complete_tree.html">Using secsse with complete phylogenies (with extinction)</a>
    <a class="dropdown-item" href="../articles/secsse_performance.html">Secsse performance</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/rsetienne/secsse/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Simulating with secsse</h1>
                        <h4 data-toc-skip class="author">Thijs
Janzen</h4>
            
            <h4 data-toc-skip class="date">2023-07-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/rsetienne/secsse/blob/HEAD/vignettes/sim_with_secsse.Rmd" class="external-link"><code>vignettes/sim_with_secsse.Rmd</code></a></small>
      <div class="d-none name"><code>sim_with_secsse.Rmd</code></div>
    </div>

    
    
<p>A good test of the fit of your secsse model, is to verify found
parameter estimates using simulations. In other words: we want to know
if the recovered model will also be recovered when the true model is
really the focal model. If it is not, then although you found the best
fitting model, this model does not explain the data well. Alternatively,
you might want to create some artificial data to test your pipeline on.
In either case, simulating a tree under the secsse model can come in
very handy!</p>
<div class="section level3">
<h3 id="prep-work">Prep work<a class="anchor" aria-label="anchor" href="#prep-work"></a>
</h3>
<p>Tree simulation in secsse takes a very similar form to performing a
Maximum Likelihood analysis, e.g. again we need to formulate our Lambda
List, Mu vector and Q matrix, and this time we also need to populate
these with actual values.</p>
<div class="section level4">
<h4 id="creating-parameter-structure">Creating parameter structure<a class="anchor" aria-label="anchor" href="#creating-parameter-structure"></a>
</h4>
<p>For a more detailed description of how the Lambda List, Mu vector and
Q matrix work, we refer to the vignette
<code><a href="../articles/starting_secsse.html">vignette("starting_secsse", package = "secsse")</a></code>. We will
here first simulate using the CR model:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">spec_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">spec_matrix</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">lambda_list</span> <span class="op">&lt;-</span> <span class="fu">secsse</span><span class="fu">::</span><span class="fu"><a href="../reference/create_lambda_list.html">create_lambda_list</a></span><span class="op">(</span>state_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                                          num_concealed_states <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                                          transition_matrix <span class="op">=</span> <span class="va">spec_matrix</span>,</span>
<span>                                          model <span class="op">=</span> <span class="st">"CR"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mu_vector</span> <span class="op">&lt;-</span> <span class="fu">secsse</span><span class="fu">::</span><span class="fu"><a href="../reference/create_mu_vector.html">create_mu_vector</a></span><span class="op">(</span>state_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                                   num_concealed_states <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                                   model <span class="op">=</span> <span class="st">"CR"</span>,</span>
<span>                                   lambda_list <span class="op">=</span> <span class="va">lambda_list</span><span class="op">)</span></span>
<span></span>
<span><span class="va">shift_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">shift_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">shift_matrix</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">q_matrix</span> <span class="op">&lt;-</span> <span class="fu">secsse</span><span class="fu">::</span><span class="fu"><a href="../reference/create_q_matrix.html">create_q_matrix</a></span><span class="op">(</span>state_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                                    num_concealed_states <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                                    shift_matrix <span class="op">=</span> <span class="va">shift_matrix</span>,</span>
<span>                                    diff.conceal <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>In order for secsse to be able to use these to simulate a tree, we
need to provide actual starting parameters. secsse has a helping
function (<code>fil_in()</code>) for that as well!</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">speciation_rate</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span><span class="va">extinction_rate</span> <span class="op">&lt;-</span> <span class="fl">0.05</span></span>
<span><span class="va">q_ab</span> <span class="op">&lt;-</span> <span class="fl">0.1</span></span>
<span><span class="va">q_ba</span> <span class="op">&lt;-</span> <span class="fl">0.1</span></span>
<span><span class="va">used_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">speciation_rate</span>, <span class="va">extinction_rate</span>, <span class="va">q_ab</span>, <span class="va">q_ba</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_lambda_list</span> <span class="op">&lt;-</span> <span class="fu">secsse</span><span class="fu">::</span><span class="fu"><a href="../reference/fill_in.html">fill_in</a></span><span class="op">(</span><span class="va">lambda_list</span>, <span class="va">used_params</span><span class="op">)</span></span>
<span><span class="va">sim_mu_vector</span>   <span class="op">&lt;-</span> <span class="fu">secsse</span><span class="fu">::</span><span class="fu"><a href="../reference/fill_in.html">fill_in</a></span><span class="op">(</span><span class="va">mu_vector</span>, <span class="va">used_params</span><span class="op">)</span></span>
<span><span class="va">sim_q_matrix</span>    <span class="op">&lt;-</span> <span class="fu">secsse</span><span class="fu">::</span><span class="fu"><a href="../reference/fill_in.html">fill_in</a></span><span class="op">(</span><span class="va">q_matrix</span>, <span class="va">used_params</span><span class="op">)</span></span></code></pre></div>
<p>The function <code><a href="../reference/fill_in.html">fill_in()</a></code> will go over the different
objects and fill in the appropriate parameter value from the
<code>used_params</code> vector, e.g. when it finds a <code>1</code> as
rate indicator, it enters the value at position
<code>used_params[1]</code>, when it encounters a <code>2</code> as rate
indicator, it enters the value at position <code>used_params[2]</code>
etc.</p>
</div>
</div>
<div class="section level2">
<h2 id="simulating">Simulating<a class="anchor" aria-label="anchor" href="#simulating"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_tree</span> <span class="op">&lt;-</span> <span class="fu">secsse</span><span class="fu">::</span><span class="fu"><a href="../reference/secsse_sim.html">secsse_sim</a></span><span class="op">(</span>lambdas <span class="op">=</span> <span class="va">sim_lambda_list</span>,</span>
<span>                               mus <span class="op">=</span> <span class="va">sim_mu_vector</span>,</span>
<span>                               qs <span class="op">=</span> <span class="va">sim_q_matrix</span>,</span>
<span>                               crown_age <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                               num_concealed_states <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                               seed <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"diversitree"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">traits_for_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>trait <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">sim_tree</span><span class="op">$</span><span class="va">obs_traits</span><span class="op">)</span>,</span>
<span>                                row.names <span class="op">=</span> <span class="va">sim_tree</span><span class="op">$</span><span class="va">phy</span><span class="op">$</span><span class="va">tip.label</span><span class="op">)</span></span>
<span>  <span class="fu">diversitree</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/diversitree/man/trait.plot.html" class="external-link">trait.plot</a></span><span class="op">(</span>tree <span class="op">=</span> <span class="va">sim_tree</span><span class="op">$</span><span class="va">phy</span>,</span>
<span>                          dat <span class="op">=</span> <span class="va">traits_for_plot</span>,</span>
<span>                          cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"trait"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"red"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                          type <span class="op">=</span> <span class="st">"p"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim_tree</span><span class="op">$</span><span class="va">phy</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required namespace: diversitree</span></span></code></pre>
<p><img src="sim_with_secsse_files/figure-html/simulate_tree-1.png" width="700"></p>
<div class="section level3">
<h3 id="conditioning">Conditioning<a class="anchor" aria-label="anchor" href="#conditioning"></a>
</h3>
<p>Notice that <code><a href="../reference/secsse_sim.html">secsse_sim()</a></code> can simulate a tree
conditioning on different tip-states: either it uses the conditioning
<code>obs_states</code>, in which case secsse will keep simulating until
it simulates a tree that has all observed states. This is usually
advised, as typically the observed states are the starting point of the
analysis, and not having observed all of them seems unrealistic.
Alternatively, secsse can also condition on <code>true_states</code> -
in this case secsse will try to simulate until all possible combinations
of observed and concealed states are present at the tips:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_tree</span> <span class="op">&lt;-</span> <span class="fu">secsse</span><span class="fu">::</span><span class="fu"><a href="../reference/secsse_sim.html">secsse_sim</a></span><span class="op">(</span>lambdas <span class="op">=</span> <span class="va">sim_lambda_list</span>,</span>
<span>                               mus <span class="op">=</span> <span class="va">sim_mu_vector</span>,</span>
<span>                               qs <span class="op">=</span> <span class="va">sim_q_matrix</span>,</span>
<span>                               crown_age <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                               num_concealed_states <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                               conditioning <span class="op">=</span> <span class="st">"obs_states"</span>,</span>
<span>                               seed <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span><span class="va">sim_tree</span><span class="op">$</span><span class="va">obs_traits</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "1" "1" "1" "1" "1" "1" "1" "1" "1" "1" "1" "1" "1" "0" "0" "1" "1" "1" "1"</span></span>
<span><span class="co">## [20] "1" "1" "1"</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_tree</span><span class="op">$</span><span class="va">true_traits</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "1B" "1B" "1A" "1B" "1B" "1B" "1B" "1B" "1B" "1B" "1B" "1A" "1A" "0B" "0B"</span></span>
<span><span class="co">## [16] "1B" "1A" "1A" "1A" "1A" "1A" "1B"</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_tree</span> <span class="op">&lt;-</span> <span class="fu">secsse</span><span class="fu">::</span><span class="fu"><a href="../reference/secsse_sim.html">secsse_sim</a></span><span class="op">(</span>lambdas <span class="op">=</span> <span class="va">sim_lambda_list</span>,</span>
<span>                               mus <span class="op">=</span> <span class="va">sim_mu_vector</span>,</span>
<span>                               qs <span class="op">=</span> <span class="va">sim_q_matrix</span>,</span>
<span>                               crown_age <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                               num_concealed_states <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                               conditioning <span class="op">=</span> <span class="st">"true_states"</span>,</span>
<span>                               seed <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span><span class="va">sim_tree</span><span class="op">$</span><span class="va">obs_traits</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "0" "1" "1" "1" "0" "0" "0" "0" "0" "0" "0" "0" "0" "0"</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_tree</span><span class="op">$</span><span class="va">true_traits</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "0A" "1B" "1A" "1A" "0A" "0A" "0A" "0A" "0A" "0A" "0A" "0B" "0B" "0B"</span></span></code></pre>
<p>Here, we have only explored a two-state system and the differences
may not be very large, but for large numbers of states, such
conditioning might yield very different trees.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Leonel Herrera Alsina, Paul van Els, Rampal S. Etienne.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
