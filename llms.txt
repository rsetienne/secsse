# SecSSE: Several Examined and Concealed States-Dependent Speciation and Extinction

[![CRAN
status](https://www.r-pkg.org/badges/version/secsse)](https://CRAN.R-project.org/package=secsse)
[![](http://cranlogs.r-pkg.org/badges/grand-total/secsse)](https://CRAN.R-project.org/package=secsse)
[![](http://cranlogs.r-pkg.org/badges/secsse)](https://CRAN.R-project.org/package=secsse)
[![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.8393098.svg)](https://doi.org/10.5281/zenodo.8393098)

| Branch    | [![GitHub Actions logo](reference/figures/github_actions_logo.png)](https://github.com/features/actions)                                                                                  | [![Codecov logo](reference/figures/Codecov.png)](https://www.codecov.io)                                                                          |
|-----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------|
| `master`  | [![R-CMD-check](https://github.com/rsetienne/secsse/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/rsetienne/secsse/actions/workflows/R-CMD-check.yaml)                | [![codecov.io](https://codecov.io/gh/rsetienne/secsse/branch/master/graph/badge.svg)](https://codecov.io/github/rsetienne/secsse/branch/master)   |
| `develop` | [![R-CMD-check](https://github.com/rsetienne/secsse/actions/workflows/R-CMD-check.yaml/badge.svg?branch=develop)](https://github.com/rsetienne/secsse/actions/workflows/R-CMD-check.yaml) | [![codecov.io](https://codecov.io/gh/rsetienne/secsse/branch/develop/graph/badge.svg)](https://codecov.io/github/rsetienne/secsse/branch/develop) |

## What is SecSSE?

SecSSE is an R package designed for multistate data sets under a
concealed state and speciation (`hisse`) framework. In this sense, it is
parallel to the ‘MuSSE’ functionality implemented in `diversitree`, but
it accounts for finding possible spurious relationships between traits
and diversification rates (“false positives”, Rabosky & Goldberg 2015)
by testing against a “hidden trait” (Beaulieu et al. 2013), which is
responsible for more variation in diversification rates than the trait
being investigated.

## Installing secsse

The `secsse` package has a stable version on
[CRAN](https://CRAN.R-project.org/package=secsse) and a development
version on GitHub.

### From CRAN

From within R, do:

``` r
install.packages("secsse")
```

### From GitHub

Install secsse from this GitHub repository by running:

``` r
install.packages("remotes")
remotes::install_github("rsetienne/secsse")
```

## Using secsse as a package dependency

### From CRAN

To your DESCRIPTION file, add `secsse` as any normal package.

If your package directly uses `secsse`:

    Imports:
      secsse

If your package uses `secsse` in its peripherals (e.g. vignettes and
tests):

    Suggests:
      secsse

### From GitHub

    Remotes:
      rsetienne/secsse

## Cite

If you use `secsse` in your publications, please cite:

- Herrera-Alsina, Leonel et al. “Detecting the Dependence of
  Diversification on Multiple Traits from Phylogenetic Trees and Trait
  Data.” Systematic biology vol. 68,2 (2019): 317-328.
  <https://doi.org/10.1093/sysbio/syy057>

## References

- Beaulieu, Jeremy M et al. “Identifying hidden rate changes in the
  evolution of a binary morphological character: the evolution of plant
  habit in campanulid angiosperms.” Systematic biology vol. 62,5 (2013):
  725-37. <https://doi.org/.1093/sysbio/syt034>

- Beaulieu, Jeremy M, and Brian C O’Meara. “Detecting Hidden
  Diversification Shifts in Models of Trait-Dependent Speciation and
  Extinction.” Systematic biology vol. 65,4 (2016): 583-601.
  <https://doi.org/10.1093/sysbio/syw022>

- Rabosky, Daniel L., and Emma E. Goldberg. “Model inadequacy and
  mistaken inferences of trait-dependent speciation.” Systematic biology
  64.2 (2015): 340-355. <https://doi.org/10.1093/sysbio/syu131>

# Package index

## All functions

- [`cla_id_paramPos()`](https://rsetienne.github.io/secsse/reference/cla_id_paramPos.md)
  : Parameter structure setting for cla_secsse It sets the parameters
  (speciation, extinction and transition) IDs. Needed for ML calculation
  with cladogenetic options (cla_secsse_ml)

- [`cla_secsse_loglik()`](https://rsetienne.github.io/secsse/reference/cla_secsse_loglik.md)
  : Likelihood for SecSSE model, using Rcpp Loglikelihood calculation
  for the cla_SecSSE model given a set of parameters and data using Rcpp

- [`cla_secsse_ml()`](https://rsetienne.github.io/secsse/reference/cla_secsse_ml.md)
  : Maximum likehood estimation for (SecSSE)

- [`cla_secsse_ml_func_def_pars()`](https://rsetienne.github.io/secsse/reference/cla_secsse_ml_func_def_pars.md)
  : Maximum likehood estimation for (SecSSE) with parameter as complex
  functions. Cladogenetic version

- [`create_default_lambda_transition_matrix()`](https://rsetienne.github.io/secsse/reference/create_default_lambda_transition_matrix.md)
  : Helper function to create a default lambda list

- [`create_default_shift_matrix()`](https://rsetienne.github.io/secsse/reference/create_default_shift_matrix.md)
  :

  Helper function to create a default `shift_matrix` list

- [`create_lambda_list()`](https://rsetienne.github.io/secsse/reference/create_lambda_list.md)
  : Helper function to automatically create lambda matrices, based on
  input. When choosing the CTD model, rates associated with observed
  states are now re-distributed to concealed states. This implicitly
  assumes that the number of observed and concealed states is identical.

- [`create_mu_vector()`](https://rsetienne.github.io/secsse/reference/create_mu_vector.md)
  : Generate mus vector

- [`create_q_matrix()`](https://rsetienne.github.io/secsse/reference/create_q_matrix.md)
  : Helper function to neatly setup a Q matrix, without transitions to
  concealed states (only observed transitions shown)

- [`event_times()`](https://rsetienne.github.io/secsse/reference/event_times.md)
  : Event times of a (possibly non-ultrametric) phylogenetic tree

- [`example_phy_GeoSSE`](https://rsetienne.github.io/secsse/reference/example_phy_GeoSSE.md)
  : A phylogeny with traits at the tips

- [`expand_q_matrix()`](https://rsetienne.github.io/secsse/reference/expand_q_matrix.md)
  : Function to expand an existing q_matrix to a number of concealed
  states

- [`extract_par_vals()`](https://rsetienne.github.io/secsse/reference/extract_par_vals.md)
  : Extract parameter values out of the result of a maximum likelihood
  inference run

- [`fill_in()`](https://rsetienne.github.io/secsse/reference/fill_in.md)
  : Helper function to enter parameter value on their right place

- [`id_paramPos()`](https://rsetienne.github.io/secsse/reference/id_paramPos.md)
  :

  Parameter structure setting Sets the parameters (speciation,
  extinction and transition) ids. Needed for ML calculation
  ([`secsse_ml()`](https://rsetienne.github.io/secsse/reference/secsse_ml.md)).

- [`phylo_vignette`](https://rsetienne.github.io/secsse/reference/phylo_vignette.md)
  : A phylogenetic reconstuction to run the vignette

- [`plot_idparslist()`](https://rsetienne.github.io/secsse/reference/plot_idparslist.md)
  : function to visualize the structure of the idparslist

- [`plot_state_exact()`](https://rsetienne.github.io/secsse/reference/plot_state_exact.md)
  : Plot the local probability along a tree

- [`prepare_full_lambdas()`](https://rsetienne.github.io/secsse/reference/prepare_full_lambdas.md)
  : Prepares the entire set of lambda matrices for cla_secsse. It
  provides the set of matrices containing all the speciation rates

- [`q_doubletrans()`](https://rsetienne.github.io/secsse/reference/q_doubletrans.md)
  : Basic Qmatrix Sets a Q matrix where double transitions are not
  allowed

- [`secsse_loglik()`](https://rsetienne.github.io/secsse/reference/secsse_loglik.md)
  : Likelihood for SecSSE model Loglikelihood calculation for the SecSSE
  model given a set of parameters and data

- [`secsse_loglik_eval()`](https://rsetienne.github.io/secsse/reference/secsse_loglik_eval.md)
  : Likelihood for SecSSE model Logikelihood calculation for the SecSSE
  model given a set of parameters and data, returning also the
  likelihoods along the branches

- [`secsse_ml()`](https://rsetienne.github.io/secsse/reference/secsse_ml.md)
  : Maximum likehood estimation for (SecSSE)

- [`secsse_ml_func_def_pars()`](https://rsetienne.github.io/secsse/reference/secsse_ml_func_def_pars.md)
  : Maximum likehood estimation for (SecSSE) complex functions as
  parameter

- [`secsse_sim()`](https://rsetienne.github.io/secsse/reference/secsse_sim.md)
  : Function to simulate a tree, conditional on observing all states.

- [`secsse_single_branch_loglik()`](https://rsetienne.github.io/secsse/reference/secsse_single_branch_loglik.md)
  : Likelihood for SecSSE model Loglikelihood calculation for the SecSSE
  model given a set of parameters and data, calculated for a single
  branch

- [`sortingtraits()`](https://rsetienne.github.io/secsse/reference/sortingtraits.md)
  : Data checking and trait sorting In preparation for likelihood
  calculation, it orders trait data according the tree tips

- [`traits`](https://rsetienne.github.io/secsse/reference/traits.md) : A
  table with trait info to run the vignette

# Articles

### Articles

- [Starting
  secsse](https://rsetienne.github.io/secsse/articles/starting_secsse.md):
- [Plotting
  probabilities](https://rsetienne.github.io/secsse/articles/plotting_states.md):
- [Simulating with
  secsse](https://rsetienne.github.io/secsse/articles/sim_with_secsse.md):
- [Using secsse with complete phylogenies (with
  extinction)](https://rsetienne.github.io/secsse/articles/complete_tree.md):
- [Secsse
  performance](https://rsetienne.github.io/secsse/articles/secsse_performance.md):
